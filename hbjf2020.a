!src "macros.a"
!src "stub.a"

; -------------------
;  ASM
; -------------------

*=$0820

	; clear screen
	jsr clrscr

	; set colors
	+setabs foreground, black
	+setabs background, dark_grey

	; switch to lowercase mode
	+switch_lowercase

	; set 38 column mode
	+setabs horscroll, col38


beginning

	;enable all sprites
	+setabs sprite_enable, $ff


	; copy sprite data for all sprites 
	ldx #$00
-
	lda sprite_0, x
	sta $2000 + 64 * 0, x
	lda sprite_1, x
	sta $2000 + 64 * 1, x
	lda sprite_2, x
	sta $2000 + 64 * 2, x
	inx
	cpx #$41
	bne -

	; set the sprite pointers to our image data
	+setabs sprite_ptr_0, ($2000 + 64 * 0) / 64 ; j
	+setabs sprite_ptr_1, ($2000 + 64 * 1) / 64 ; e
	+setabs sprite_ptr_2, ($2000 + 64 * 2) / 64 ; f
	+setabs sprite_ptr_3, ($2000 + 64 * 2) / 64 ; f, same as sprite 2

	; all sprites expanded 2x in x and y
	+setabs sprite_x_expansion, 2^0 + 2^1 + 2^2 + 2^3
	+setabs sprite_y_expansion, 2^0 + 2^1 + 2^2 + 2^3

	; set basic sprite color
	+setabs sprite_col_0, dark_grey
	+setabs sprite_col_1, dark_grey
	+setabs sprite_col_2, dark_grey
	+setabs sprite_col_3, dark_grey

	; set all sprites to multicolor
	+setabs sprite_multi, 2^0 + 2^1 + 2^2 + 2^3
	+setabs sprite_multicolor_1, grey
	+setabs sprite_multicolor_2, light_grey

	; set sprite x positions
	+setabs sprite_0_x, ($64)
	+setabs sprite_1_x, ($64 + $2b)
	+setabs sprite_2_x, ($64 + $2b + $26)
	+setabs sprite_3_x, ($64 + $2b + $26 + $1d)

	; set sprite y positions
	+setabs sprite_0_y, $84
	+setabs sprite_1_y, $84
	+setabs sprite_2_y, $84
	+setabs sprite_3_y, $84


; -------------------
;  Horizontal Scroll
; -------------------

	ldy #$00

loop
	+sleep
	ldx #$07
	stx horscroll

	ldx #$00
	sty .hi1
-
	lda .msg, y
	cmp #$00
	bne +
	ldy #$00
	jmp -
+
	iny

	;sta $0400, x
	sta $0680, x

	inx
	cpx #$27
	bne -

	ldy .hi1
	iny
	lda .msg, y
	cmp #$00
	bne +
	ldy #$00
	sty .hi1
+

start_horscroll

	ldx #$07
-

	stx horscroll
	cpx #$00
	beq loop
	dex
	+sleep
	jmp -

; The End.

	rts


; ---------------
;  data
; ---------------

!addr {
	clrscr = $e544
	background = $d020
	foreground = $d021
	horscroll = $d016

	sprite_enable = $d015

	sprite_ptr_0 = $07f8
	sprite_ptr_1 = $07f9
	sprite_ptr_2 = $07fa
	sprite_ptr_3 = $07fb

	sprite_col_0 = $d027
	sprite_col_1 = $d028
	sprite_col_2 = $d029
	sprite_col_3 = $d02a

	sprite_multi = $d01c

	sprite_0_x = $d000
	sprite_0_y = $d001
	sprite_1_x = $d002
	sprite_1_y = $d003
	sprite_2_x = $d004
	sprite_2_y = $d005
	sprite_3_x = $d006
	sprite_3_y = $d007

	sprite_x_expansion = $d01d
	sprite_y_expansion = $d017

	sprite_multicolor_1 = $d025
	sprite_multicolor_2 = $d026
}

; 38 columns mode for horscroll

col40 = $08
col38 = $00

; colors

black				= $00
white				= $01 
red					= $02
blue				= $06
cyan				= $03
purple			= $04
green				= $05
yellow			= $07
orange			= $08
brown				= $09
pink				= $0A
dark_grey		= $0B
grey				= $0C
light_green	= $0D
light_blue	= $0E
light_grey	= $0F

; registers 

.r1		!byte $fb  ; fb/fc  as 16-bits register 1
.hi1	!byte $fb
.lo1	!byte $fc

.r2		!byte $fd  ; fd/fe  as 16-bits register 2
.hi2	!byte $fd
.lo2	!byte $fe

; some test title
.msg !scr "      Bonsoir papa. Ceci est un test. Ce message devrait avoir plus de 38 caracteres de long, mais moins de 256 caracteres. --- ", 0

; color scheme
.colors !byte $01, $0e, $06, $0e

!src "sprites.a"

; vim: ft=acme ts=2 sw=2
